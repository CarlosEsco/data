<html>
<head>
    <script>
        async function LoadSimilarMapping() {
            let queryString = window.location.search
            const urlParams = new URLSearchParams(queryString)

            const regexExp = /^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/gi;

            let error = false

            let errorParam = "error"

            if (urlParams.has("uuid")) {

                try {
                    let uuid = urlParams.get("uuid")

                    errorParam = uuid
                    console.log(uuid)
                    console.log(regexExp.test(uuid))

                    if (regexExp.test(uuid)) {


                        let prefix = uuid.slice(0, 2)


                        const response = await fetch("https://cdn.jsdelivr.net/gh/CarlosEsco/data@update/similar/" + prefix + ".html")
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }

                        let data = (await response.text()).split("\n")

                        let matchingLine = data.find((line) => line.startsWith(uuid))

                        if (matchingLine != null && matchingLine.length > 0) {
                            let escapedJson = matchingLine.split(":::||@!@||:::")[1]
                            let obj = JSON.parse(escapedJson);
                            document.body.innerHTML = "";
                            let pre = document.createElement("pre")
                            pre.appendChild(document.createTextNode(JSON.stringify(obj, null, '\t')))
                            document.body.appendChild(pre);
                        } else {
                            console.log("No matching UUID")
                            error = true
                        }

                    }
                } catch (error) {
                    console.error(error)
                    error = true
                }

            }

            if (error) {
                location.href = errorParam;
            }
        }


    </script>
</head>

<body onload="LoadSimilarMapping()"></body>

</html>