<html>
<head>
    <script>
        function LoadSimilarMapping() {
            let queryString = window.location.search
            console.log(queryString)
            const urlParams = new URLSearchParams(queryString)

            const regexExp = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;


            let error = true

            if(urlParams.has("uuid")){
                try {
                    let uuid = urlParams.get("uuid")
                    console.log(uuid)

                    if(regexExp.test(uuid)) {

                        let prefix = uuid.slice(0, 2)
                        console.log(prefix)

                        let xmlhttp = new XMLHttpRequest();
                        xmlhttp.open("GET", "https://cdn.jsdelivr.net/gh/CarlosEsco/data@update/similar/" + prefix + ".csv", false);
                        xmlhttp.send();

                        let data = xmlhttp.responseText.split("\n")

                        let matchingLine = data.find((line) => line.startsWith(uuid))

                        if (matchingLine != null && matchingLine.length > 0) {
                            let escapedJson = matchingLine.split(":::||@!@||:::")[1]
                            let obj = JSON.parse(escapedJson);
                            document.body.innerHTML = "";
                            document.body.writeln("<pre>")
                            document.body.appendChild(document.createTextNode(JSON.stringify(obj, null, '\t')));
                            document.body.writeln("</pre>")
                            error = false
                        }
                    }
                }
                catch(error){
                  console.error(error)
                }

            }

            if(error){
                location.href = 'error';
            }

        }
    </script>
</head>

<body onload="LoadSimilarMapping()"></body>

</html>