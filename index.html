<html>
<head>
    <script>
        function LoadSimilarMapping() {
            let queryString = window.location.search
            console.log(queryString)
            const urlParams = new URLSearchParams(queryString)

            let error = false

            if(urlParams.has("uuid")){
                let uuid = urlParams.get("uuid")
                console.log(uuid)
                let prefix = uuid.slice(0,2)
                console.log(prefix)

                let xmlhttp=new XMLHttpRequest();
                xmlhttp.open("GET", "https://github.com/CarlosEsco/data/blob/update/similar/"+prefix+".csv", false);
                xmlhttp.send();

                let data = xmlhttp.responseText.split("\n")

                let matchingLine = data.find((line) => line.startsWith(uuid))

                if (matchingLine != null && matchingLine.length > 0) {
                    let escapedJson = matchingLine.split(":::||@!@||:::")[1]
                    let obj = JSON.parse(escapedJson);
                    document.body.innerHTML = "";
                    document.body.appendChild(document.createTextNode(JSON.stringify(obj, null, 4)));
                }else{
                    error = true
                    location.href = 'error';
                }
            }else{
                error = true
            }

            if(error){
                location.href = 'error';
            }

        }
    </script>
</head>

<body onload="LoadSimilarMapping()"></body>

</html>